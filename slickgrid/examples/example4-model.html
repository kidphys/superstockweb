<!DOCTYPE HTML>
<html>
<head>
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <meta http-equiv="Content-Type" content="text/html; charset=utf-8">
  <title>Superstock</title>

  <!-- Bootstrap Latest compiled and minified CSS -->
  <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.6/css/bootstrap.min.css" integrity="sha384-1q8mTJOASx8j1Au+a5WDVnPi2lkFfwwEAa8hDDdjZlpLegxhjVME1fgjWPGmkzs7" crossorigin="anonymous">

  <link rel="stylesheet" href="../slick.grid.css" type="text/css"/>
  <link rel="stylesheet" href="../controls/slick.pager.css" type="text/css"/>
  <link rel="stylesheet" href="../css/smoothness/jquery-ui-1.8.16.custom.css" type="text/css"/>
  <link rel="stylesheet" href="examples.css" type="text/css"/>
  <link rel="stylesheet" href="../controls/slick.columnpicker.css" type="text/css"/>

  <script src="https://cdn.firebase.com/js/client/2.4.2/firebase.js"></script>

  <script src="../lib/jquery-1.7.min.js"></script>
  <script src="../lib/firebugx.js"></script>

  <script src="../lib/jquery-ui-1.8.16.custom.min.js"></script>
  <script src="../lib/jquery.event.drag-2.2.js"></script>
  <script type="text/javascript" src="//cdnjs.cloudflare.com/ajax/libs/jqueryui-touch-punch/0.2.3/jquery.ui.touch-punch.min.js"></script>
  <!-- jQuery mobile -->
  <link rel="stylesheet" href="http://code.jquery.com/mobile/1.4.5/jquery.mobile-1.4.5.min.css" type="text/css"/>
  <script src="http://code.jquery.com/mobile/1.4.5/jquery.mobile-1.4.5.min.js"></script>

  <script src="../superstock.js"></script>
  <script src="../supertable.js"></script>
  <script src="../data.js"></script>
  <style>
    .grid-header {
      border: 1px solid gray;
      color: black;
      background: white;
      height: 40px;
    }

    .cell-title {
      font-weight: bold;
    }

    .cell-effort-driven {
      text-align: center;
    }

    .cell-selection {
      border-right-color: silver;
      border-right-style: solid;
      background: white;
      color: black;
      text-align: right;
      font-size: 10px;
    }

    .slick-header-column.ui-state-default {
      height: 25px;
    }

    .slick-row.selected .cell-selection {
      background-color: transparent; /* show default selected row background */
    }

    #slider_panel > span {
      height:120px;
      float:left;
      margin:15px 15px 15px 30px;
    }
  </style>
</head>
<body>
<div class="container-fluid">
  <!--
  Very hacky way, here we embed the jQuery mobile into a bootstrap theme, may be remove the bootstrap is better?
  -->
  <div class="row" style="height:50px">
    <div data-role="page" id='filter_panel_page' data-url='yay'>
        <div data-role="panel" id="filter_panel" data-position="left" data-display="overlay">
<!--             <label for="slider-matchedPrice">Giá khớp</label>
            <input type="range" name="slider-matchedPrice" id="slider-matchedPrice" value="60" min="0" max="200" data-highlight="true">
            <label for="slider-AvgVolT30">KLTB 30 ngày</label>
            <input type="range" name="slider-AvgVolT30" id="slider-AvgVolT30" value="50000" min="0" max="100000" step="50" data-highlight="true">
            <label for="slider-EPS">EPS</label>
            <input type="range" name="slider-EPS" id="slider-EPS" value="60" min="0" max="1000" step="50" data-highlight="true">
            <label for="slider-accumulatedVol">KLGD</label>
            <input type="range" name="slider-accumulatedVol" id="slider-accumulatedVol" value="60" min="0" max="1000" step="50" data-highlight="true">

 -->        </div>
        <div data-role="header">
          <div data-role="navbar">
            <ul>
              <li><a href="#anylink">Home</a></li>
              <li><a href="#anylink">Page Two</a></li>
              <li><a href="#filter_panel">Lọc</a></li>
            </ul>
          </div>
        </div>
    </div>
  </div>

  <div class="row">
    <!-- Slick Grid -->
    <div class="col-md-12 col-xs-12">
      <div style="position:relative">
        <div>
          <div class="grid-header" style="width:100%">
            <label>Siêu cổ phiếu</label>
          </div>
          <div id="myGrid" style="width:100%;height:500px;"></div>
          <div id="pager" style="width:100%;height:20px;"></div>
        </div>
      </div>
    </div>
  </div>
  <!-- End Slick Grid -->

</div>


<div id="inlineFilterPanel" style="display:none;background:#dddddd;padding:3px;color:black;">
  Lọc mã chỉ có giá >= <input type="text" id="txtPrice">
  KLGD >= <input type="text" id="txtGTGD">
  <div class="row" id="slider_panel"></div>
</div>

<script src="../slick.core.js"></script>
<script src="../slick.formatters.js"></script>
<script src="../slick.editors.js"></script>
<script src="../plugins/slick.rowselectionmodel.js"></script>
<script src="../slick.grid.js"></script>
<script src="../slick.dataview.js"></script>
<script src="../controls/slick.pager.js"></script>
<script src="../controls/slick.columnpicker.js"></script>
<script src="../controls/slick.columnpicker.js"></script>

<script>
  var slider_settings = [
    {id: 'slider-matchedPrice', value: 10, max: 200, label: 'Price: '},
    {id: 'slider-EPS', value: 10, max: 200, label: 'EPS: '},
  ];

  var built = false;

  $(document).bind('pagebeforechange', function(e, data){
    console.log('Page before changed', data);
    if(!built) {
      build_mobile_filter_panel('#filter_panel', slider_settings);
      built = true;
    }
  });

  $(document).bind('pagechange', function(e, data) {
    console.log('Page change');
    for(var i = 0; i < slider_settings.length; i++) {
        (function(slider) {
            var $slider = $('#' + slider.id);
            console.log('Binding slider', $slider);
            $slider.bind('change', function() {
                slider.value = $slider.val();
                console.log('Slider changed ', slider.value);
                // callback(slider.key, slider);
            });
        })(slider_settings[i]);
    }
  });

  $(document).ready(function() {
        var fields = field_str.split('|');
        var data_arr = Object.keys(data).map(function(key) {
            return data[key].split('|');
        });
        var items = build_json_array(fields, data_arr);
        var slick = build_slick_grid(build_columns(fields));
            slick.update(items);

        function update_regularly() {
          setInterval(function() {
            for(var i = 0; i < items.length; i++) {
              items[i].accumulatedVol = Math.round(Math.random() * 5000000);
            }
            console.log('updating', items[0], items[0].accumulatedVol);
            slick.update(items);
          }, 2000);
        }

        var grid = slick.get_grid();
        var dataView = slick.get_dataview();

        /**
        Building the slider
        */



        // var slider_settings = [
        //   {id: '#slider-matchedPrice', value: 10, key: 'matchedPrice'},
        //   {id: '#slider-AvgVolT30', value: 10000, key: 'AvgVolT30'},
        //   {id: '#slider-accumulatedVol', value: 10000, key: 'accumulatedVol'},
        //   {id: '#slider-EPS', value: 10, key: 'EPS'},
        // ];
        // build_mobile_filter_panel(slider_settings, function(target, value) {
        //   // TODO: convert to args here?
        //   var args = {};
        //   for(var i = 0; i < slider_settings.length; i++) {
        //     var item = slider_settings[i];
        //     args[item.key] = Number(item.value) * 1000;
        //   }
        //   console.log('Filter updated', args);
        //   slick.updateFilter(args);
        // });

        // build_control_panel('#slider_panel', filterValue, function(target, value) {
        //   console.log('Slider updated', target, value);
        //   $('#txt' + target).val(value);
        // });

          // wire up the slider to apply the filter to the model
          $("#pcSlider,#pcSlider2").slider({
            "range": "min",
            "slide": function (event, ui) {
              Slick.GlobalEditorLock.cancelCurrentEdit();

              if (percentCompleteThreshold != ui.value) {
                window.clearTimeout(h_runfilters);
                h_runfilters = window.setTimeout(updateFilter, 10);
                percentCompleteThreshold = ui.value;
              }
            }
          });

        function toggleFilterRow() {
          var grid = slick.get_grid();
          grid.setTopPanelVisibility(!grid.getOptions().showTopPanel);
        }

  });
</script>
</body>
</html>
