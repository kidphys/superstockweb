<!DOCTYPE HTML>
<html>
<head>
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <meta http-equiv="Content-Type" content="text/html; charset=utf-8">
  <title>Superstock</title>

  <!-- Bootstrap Latest compiled and minified CSS -->
  <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.6/css/bootstrap.min.css" integrity="sha384-1q8mTJOASx8j1Au+a5WDVnPi2lkFfwwEAa8hDDdjZlpLegxhjVME1fgjWPGmkzs7" crossorigin="anonymous">

  <link rel="stylesheet" href="../slick.grid.css" type="text/css"/>
  <link rel="stylesheet" href="../controls/slick.pager.css" type="text/css"/>
  <link rel="stylesheet" href="../css/smoothness/jquery-ui-1.8.16.custom.css" type="text/css"/>
  <link rel="stylesheet" href="examples.css" type="text/css"/>
  <link rel="stylesheet" href="../controls/slick.columnpicker.css" type="text/css"/>
  <script src="https://cdn.firebase.com/js/client/2.4.2/firebase.js"></script>
  <script src="../superstock.js"></script>
  <script src="../supertable.js"></script>
  <script src="../data.js"></script>
  <style>
    .grid-header {
      border: 1px solid gray;
      color: black;
      background: white;
      height: 40px;
    }

    .cell-title {
      font-weight: bold;
    }

    .cell-effort-driven {
      text-align: center;
    }

    .cell-selection {
      border-right-color: silver;
      border-right-style: solid;
      background: white;
      color: black;
      text-align: right;
      font-size: 10px;
    }

    .slick-header-column.ui-state-default {
      height: 25px;
    }

    .slick-row.selected .cell-selection {
      background-color: transparent; /* show default selected row background */
    }

    #slider_panel > span {
      height:120px;
      float:left;
      margin:15px 15px 15px 30px;
    }
  </style>
</head>
<body>
<div class="container-fluid">
  <div class="row">
    <div class="col-md-12 col-xs-12">
      <div style="position:relative">
        <div>
          <div class="grid-header" style="width:100%">
            <label>Siêu cổ phiếu</label>
            <span style="float:right" class="ui-icon ui-icon-search" title="Toggle search panel"
                  onclick="toggleFilterRow()"></span>
          </div>
          <div id="myGrid" style="width:100%;height:500px;"></div>
          <div id="pager" style="width:100%;height:20px;"></div>
        </div>
      </div>
    </div>
  </div>
</div>

<div id="inlineFilterPanel" style="display:none;background:#dddddd;padding:3px;color:black;">
  Show tasks with title including <input type="text" id="txtSearch2">
  and % at least &nbsp;
  <div style="width:100px;display:inline-block;" id="pcSlider2"></div>

      <div class="row" id="slider_panel">
        <!-- <span target="EPS"></span> -->
        <span target="Volume"></span>
<!--         <span target="GTGD"></span>
        <span target="Price"></span>
 -->      </div>
</div>

<script src="../lib/firebugx.js"></script>

<script src="../lib/jquery-1.7.min.js"></script>
<script src="../lib/jquery-ui-1.8.16.custom.min.js"></script>
<script src="../lib/jquery.event.drag-2.2.js"></script>
<script type="text/javascript" src="//cdnjs.cloudflare.com/ajax/libs/jqueryui-touch-punch/0.2.3/jquery.ui.touch-punch.min.js"></script>
<script src="../slick.core.js"></script>
<script src="../slick.formatters.js"></script>
<script src="../slick.editors.js"></script>
<script src="../plugins/slick.rowselectionmodel.js"></script>
<script src="../slick.grid.js"></script>
<script src="../slick.dataview.js"></script>
<script src="../controls/slick.pager.js"></script>
<script src="../controls/slick.columnpicker.js"></script>
<script src="../controls/slick.columnpicker.js"></script>

<script>

  var fields = field_str.split('|');
  var data_arr = Object.keys(data).map(function(key) {
      return data[key].split('|');
  });
  var items = build_json_array(fields, data_arr);
  var slick = build_slick_grid(build_columns(fields));
      slick.update(items);
  setInterval(function() {
    for(var i = 0; i < items.length; i++) {
      items[i].accumulatedVol = Math.round(Math.random() * 5000000);
    }
    console.log('updating', items[0], items[0].accumulatedVol);
    slick.update(items);
  }, 2000);
  var grid = slick.get_grid();
  var dataView = slick.get_dataview();

  /**
  Building the slider
  */
  var h_runfilters = null;
  var filterValue = {
    EPS: {value: 2, max: 100},
    GTGD: {value: 10, max: 100000000},
    Price: {value: 10, max: 200},
    Volume: {value: 100, max: 5000000},
  };
  $('#slider_panel>span').each(function() {
    var $this = $(this);
    var target = $this.attr('target');
    $this.empty().slider({
      value: filterValue[target].value,
      range: 'min',
      max: filterValue[target].max,
      anitmate: true,
      orientation: 'vertical',
      slide: function(event, ui) {
        console.log('Updating filter ', target, ui.value);
        Slick.GlobalEditorLock.cancelCurrentEdit();
        filterValue[target].value = ui.value;
        slick.updateFilter({
          closePrice: filterValue['Price'].value,
          accumulatedVol: filterValue['Volume'].value,
        });
        // if(filterValue[target].value != ui.value) {
        //   window.clearTimeout(h_runfilters);
        //   h_runfilters = window.setTimeout(updateFilter, 10);
        //   filterValue[target].value = ui.value;
        // }
      },
    });
  });

    // wire up the slider to apply the filter to the model
    $("#pcSlider,#pcSlider2").slider({
      "range": "min",
      "slide": function (event, ui) {
        Slick.GlobalEditorLock.cancelCurrentEdit();

        if (percentCompleteThreshold != ui.value) {
          window.clearTimeout(h_runfilters);
          h_runfilters = window.setTimeout(updateFilter, 10);
          percentCompleteThreshold = ui.value;
        }
      }
    });

  function toggleFilterRow() {
    var grid = slick.get_grid();
    grid.setTopPanelVisibility(!grid.getOptions().showTopPanel);
  }
</script>
</body>
</html>
